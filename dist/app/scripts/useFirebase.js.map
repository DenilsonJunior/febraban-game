{"version":3,"sources":["useFirebase.js"],"names":["async","getDocumentsOrderedByField","collectionDB","fieldName","querySnapshot","empty","orderBy","get","console","log","results","let","id","data","doc","push","error","updateIfGreater","newValue","db","docRef","await","game1","transaction","game2","game3","games","Error","update","currentValue","b","addOrUpdateDocument","informativo","then","catch","name","email","empresa","uid","listenToUpdates","collection","isInitialLoad","onSnapshot","docChanges","change","call","snapshot","initFirebase","window","forEach","type","handlerFormDB","bridge","err","firebaseConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","$","document","firebaseApp","firebase","initializeApp","firestore","handlerGameDB","gameName","point","listRankingDB","handlerSnapshotFormDB"],"mappings":"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","file":"useFirebase.js","sourcesContent":["window.firebaseConfig = {\r\n  apiKey: \"AIzaSyC6r6ivnQ7Lx1Hikb_YNdQxf3lj2XOGkWA\",\r\n  authDomain: \"febraban-v1.firebaseapp.com\",\r\n  databaseURL: \"https://febraban-v1-default-rtdb.firebaseio.com\",\r\n  projectId: \"febraban-v1\",\r\n  storageBucket: \"febraban-v1.appspot.com\",\r\n  messagingSenderId: \"824190571881\",\r\n  appId: \"1:824190571881:web:370fe41aa5d1ece5ab19f8\",\r\n  measurementId: \"G-1NV8HNSJZJ\",\r\n};\r\n\r\nasync function getDocumentsOrderedByField(collectionDB, fieldName) {\r\n  try {\r\n    const querySnapshot = await collectionDB.orderBy(fieldName, \"desc\").get();\r\n\r\n    if (querySnapshot.empty) {\r\n      console.log(\"No matching documents.\");\r\n      return [];\r\n    }\r\n\r\n    let results = [];\r\n    querySnapshot.forEach((doc) => {\r\n      results.push({\r\n        id: doc.id,\r\n        data: doc.data(),\r\n      });\r\n    });\r\n\r\n    return results;\r\n  } catch (error) {\r\n    console.error(\"Error retrieving documents: \", error);\r\n    return [];\r\n  }\r\n}\r\n\r\nasync function updateIfGreater(db, docRef, fieldName, newValue) {\r\n  try {\r\n    await db.runTransaction(async (transaction) => {\r\n      const doc = await transaction.get(docRef);\r\n      if (!doc.exists) {\r\n        throw new Error(\"Document does not exist!\");\r\n      }\r\n\r\n      const game1 = doc.data()[\"game1\"] || 0;\r\n      const game2 = doc.data()[\"game2\"] || 0;\r\n      const game3 = doc.data()[\"game3\"] || 0;\r\n      const games = [game1, game2, game3];\r\n      games.sort(function (a, b) {\r\n        return b - a;\r\n      });\r\n\r\n      const currentValue = doc.data()[fieldName] || 0;\r\n\r\n      if (newValue > currentValue) {\r\n        transaction.update(docRef, {\r\n          [fieldName]: newValue,\r\n          maior: newValue > games[0] ? newValue : games[0],\r\n        });\r\n        console.log(\"Field updated because the new value is greater.\");\r\n      } else {\r\n        console.log(\"Field not updated because the new value is not greater.\");\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Transaction failed: \", error);\r\n  }\r\n}\r\n\r\nfunction addOrUpdateDocument(docRef, data) {\r\n  try {\r\n    docRef\r\n      .get()\r\n      .then((doc) => {\r\n        if (doc.exists) {\r\n          console.log(\"update\", docRef);\r\n          docRef\r\n            .update({\r\n              name: data.name,\r\n              email: data.email,\r\n              empresa: data.empresa,\r\n              informativo: data.informativo,\r\n              uid: data.uid,\r\n            })\r\n            .then(() => {\r\n              console.log(\"Document successfully update!\");\r\n            })\r\n            .catch((error) => {\r\n              console.error(\"Error update: \", error);\r\n            });\r\n        } else {\r\n          console.log(\"set\", docRef);\r\n          docRef\r\n            .set({\r\n              name: data.name,\r\n              email: data.email,\r\n              empresa: data.empresa,\r\n              informativo: data.informativo,\r\n              uid: data.uid,\r\n            })\r\n            .then(() => {\r\n              console.log(\"Document successfully written!\");\r\n            })\r\n            .catch((error) => {\r\n              console.error(\"Error writing document: \", error);\r\n            });\r\n        }\r\n      })\r\n      .catch((error) => {\r\n        console.log(\"Error set:\", error);\r\n      });\r\n  } catch (error) {\r\n    console.error(\"Erro ao adicionar ou atualizar documento: \", error);\r\n  }\r\n}\r\n\r\nfunction listenToUpdates(collection, call) {\r\n  let isInitialLoad = true;\r\n\r\n  collection.onSnapshot(\r\n    (snapshot) => {\r\n      if (isInitialLoad) {\r\n        // Ignorar o primeiro snapshot, que é o estado inicial da coleção\r\n        isInitialLoad = false;\r\n        return;\r\n      }\r\n\r\n      snapshot.docChanges().forEach((change) => {\r\n        if (change.type === \"added\") {\r\n          console.log(\"New document: \", change.doc.data());\r\n          call(change);\r\n        }\r\n        if (change.type === \"modified\") {\r\n          console.log(\"Modified document: \", change.doc.data());\r\n          call(change);\r\n        }\r\n      });\r\n    },\r\n    (err) => {\r\n      console.log(`Encountered error: ${err}`);\r\n    }\r\n  );\r\n}\r\n\r\n///Inicialização do Firebase\r\nwindow.initFirebase = false;\r\n$(document).ready(function () {\r\n  if (!window.initFirebase) {\r\n    const firebaseApp = firebase.initializeApp(window.firebaseConfig);\r\n    window.db = firebaseApp.firestore();\r\n    window.collectionDB = window.db.collection(\"usuarios\");\r\n    window.initFirebase = true;\r\n  }\r\n});\r\n\r\n/// Criação do formulario\r\nbridge.handlerFormDB = function (data) {\r\n  const docRef = window.collectionDB.doc(data.email);\r\n  addOrUpdateDocument(docRef, data);\r\n};\r\n\r\n/// Criação da nota do game\r\nbridge.handlerGameDB = function (email, gameName, point) {\r\n  const docRef = window.collectionDB.doc(email);\r\n  updateIfGreater(window.db, docRef, gameName, point);\r\n};\r\n\r\n/// Criação da Ranking\r\nbridge.listRankingDB = function (call) {\r\n  getDocumentsOrderedByField(window.collectionDB, \"maior\")\r\n    .then((results) => {\r\n      console.log(\"Documents ordered by field in descending order:\");\r\n      call(results);\r\n    })\r\n    .catch((error) => {\r\n      console.error(\"Error in getDocumentsOrderedByField: \", error);\r\n    });\r\n};\r\n\r\n/// Controle do formulário via realtime - para mobile\r\nbridge.handlerSnapshotFormDB = function (call) {\r\n  listenToUpdates(window.collectionDB, call);\r\n};\r\n"]}